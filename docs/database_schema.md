# Database Schema (`crypto_data.db`)

This document outlines the schema for the main tables generated and used by the analysis scripts.

---

## Table: `session_summary`

**Purpose:** Stores aggregated data and calculated metrics for each identified trading session (Asia, London, NewYork, Overnight, Weekend-Sat, Weekend-Sun).
**Generated By:** `market_analyzer.py`

| Column Name      | Data Type (Conceptual) | Description                                                                  |
|------------------|------------------------|------------------------------------------------------------------------------|
| `Date`           | Date                   | Calendar date (YYYY-MM-DD) derived from session timestamps.                    |
| `Sessions`       | TEXT                   | Name of the trading session (e.g., 'Asia', 'London', 'NewYork', 'LDN_NY_Overlap', 'Overnight', 'Weekend-Sat'). |
| `SessionStart`   | DATETIME (UTC)         | Timestamp of the first tick recorded for this session instance.              |
| `SessionEnd`     | DATETIME (UTC)         | Timestamp of the last tick recorded for this session instance.               |
| `SessionOpen`    | REAL (Float)           | Opening price of the session (first tick).                                 |
| `SessionHigh`    | REAL (Float)           | Highest price reached during the session.                                    |
| `SessionLow`     | REAL (Float)           | Lowest price reached during the session.                                     |
| `SessionClose`   | REAL (Float)           | Closing price of the session (last tick).                                  |
| `SessionVolume`  | REAL (Float)           | Total volume traded during the session.                                    |
| `SessionDelta`   | REAL (Float)           | Cumulative delta (AskVol - BidVol) for the session.                        |
| `SessionTicks`   | INTEGER                | Total number of ticks recorded during the session.                           |
| `SessionVPOC`    | REAL (Float)           | Volume Point of Control (price level with highest volume) for the session. |
| `TPO_POC`        | REAL (Float)           | Time Price Opportunity Point of Control (price with most TPO periods).     |
| `VAH`            | REAL (Float)           | Value Area High (upper boundary of TPO value area).                          |
| `VAL`            | REAL (Float)           | Value Area Low (lower boundary of TPO value area).                           |
| `IB_High`        | REAL (Float)           | Initial Balance High (high of first N TPO periods).                        |
| `IB_Low`         | REAL (Float)           | Initial Balance Low (low of first N TPO periods).                          |
| `PoorHigh`       | BOOLEAN (Stored as INT)| True (1) if session high is considered poor.                               |
| `PoorHighPrice`  | REAL (Float)           | Price of the poor high (NaN if `PoorHigh` is False).                       |
| `PoorLow`        | BOOLEAN (Stored as INT)| True (1) if session low is considered poor.                                |
| `PoorLowPrice`   | REAL (Float)           | Price of the poor low (NaN if `PoorLow` is False).                         |
| `SinglePrints`   | BOOLEAN (Stored as INT)| True (1) if significant single prints were found in the TPO profile.       |
| `SessionASR`     | REAL (Float)           | Average Session Range (`SessionHigh` - `SessionLow`).                        |

**Timestamp columns note**  
• `session_summary` keeps the raw UTC time in **SessionStart**.  
• All downstream indicator tables copy that value into **SessionStartUTC** so they can shift timestamps for exchange‑week calculations without losing the original key.  
In other words, `SessionStart` is the core reference stored once, while `SessionStartUTC` is the identical value repeated wherever a foreign‑key back to `session_summary` is needed.

---

## Table: `btc_key_levels`

**Purpose:** Stores calculated key reference levels (Period-based and Previous Session-based) for each session instance.
**Generated By:** `indicator_calculator.py` (using filtered `session_summary` data)

| Column Name        | Data Type (Conceptual) | Description                                                                 |
|--------------------|------------------------|-----------------------------------------------------------------------------|
| `SessionStartUTC`  | DATETIME (UTC)         | Timestamp indicating the start of the session this row applies to.          |
| `SessionDate`      | Date                   | Calendar date (YYYY-MM-DD) of the session.                                |
| `SessionOpen`      | REAL (Float)           | Opening price of this specific session.                                     |
| **--- Previous Session Levels ---** |                      |                                                                             |
| `PrevSessionOpen`  | REAL (Float)           | Opening price of the immediately preceding session.                       |
| `PrevSessionHigh`  | REAL (Float)           | Highest price of the immediately preceding session.                       |
| `PrevSessionLow`   | REAL (Float)           | Lowest price of the immediately preceding session.                        |
| `PrevSessionClose` | REAL (Float)           | Closing price of the immediately preceding session.                       |
| `PrevSessionMid`   | REAL (Float)           | Midpoint ((High+Low)/2) of the immediately preceding session.             |
| **--- Period Levels ---** |                      |                                                                             |
| `DailyOpen`        | REAL (Float)           | Opening price of the first session on this `SessionDate`.                   |
| `PrevDailyMid`     | REAL (Float)           | Midpoint of the *previous* calendar day's range.                          |
| `MondayHigh`       | REAL (Float)           | Highest price reached during *all sessions* on the Monday of this week.   |
| `MondayLow`        | REAL (Float)           | Lowest price reached during *all sessions* on the Monday of this week.    |
| `MondayMid`        | REAL (Float)           | Midpoint of the Monday's range for this week.                               |
| `MondayRange`      | REAL (Float)           | Range (High-Low) of the Monday for this week.                             |
| `WeeklyOpen`       | REAL (Float)           | Opening price of the first session of this week (starts Monday).            |
| `PrevWeekHigh`     | REAL (Float)           | Highest price reached during the *previous* week.                         |
| `PrevWeekLow`      | REAL (Float)           | Lowest price reached during the *previous* week.                          |
| `PrevWeekMid`      | REAL (Float)           | Midpoint of the *previous* week's range.                                  |
| `MonthlyOpen`      | REAL (Float)           | Opening price of the first session of this calendar month.                |
| `PrevMonthHigh`    | REAL (Float)           | Highest price reached during the *previous* calendar month.               |
| `PrevMonthLow`     | REAL (Float)           | Lowest price reached during the *previous* calendar month.                |
| `PrevMonthMid`     | REAL (Float)           | Midpoint of the *previous* calendar month's range.                        |
| `QuarterlyOpen`    | REAL (Float)           | Opening price of the first session of this calendar quarter.              |
| `PrevQuarterMid`   | REAL (Float)           | Midpoint of the *previous* calendar quarter's range.                      |
| `YearlyOpen`       | REAL (Float)           | Opening price of the first session of this calendar year.                 |
| `PrevYearMid`      | REAL (Float)           | Midpoint of the *previous* calendar year's range.                         |

---

## Table: `session_vwap`

**Purpose:** Stores rolling Volume Weighted Average Price (VWAP) values calculated per session.
**Generated By:** `indicator_calculator.py` (using filtered `session_summary` data)

| Column Name       | Data Type (Conceptual) | Description                                                                      |
|-------------------|------------------------|----------------------------------------------------------------------------------|
| `SessionStartUTC` | DATETIME (UTC)         | Timestamp indicating the start of the session this VWAP value corresponds to.    |
| `Date`            | Date                   | Calendar date (YYYY-MM-DD) of the session (potentially redundant with timestamp). |
| `RVWAP_30`        | REAL (Float)           | 30-session rolling VWAP, calculated ending at this session.                      |
| `RVWAP_365`       | REAL (Float)           | 365-session rolling VWAP, calculated ending at this session.                     |

---

## Other Potential Tables (Less Recently Used)

*   **`daily_summary`:** May contain daily aggregated OHLCV, Delta, ATR. Generated by `market_analyzer.py` initially.
*   **`tick_data`:** May contain the raw tick data (Timestamp, OHLC, Volume, Trades, BidVol, AskVol) if saved by `market_analyzer.py`. Generated by `market_analyzer.py` initially. 